- name: Clean previous builds
  run: |
    rm -rf .buildozer bin
    rm -f *.apk *.aab

- name: Build with buildozer (release)
  env:
    KEYSTORE_PASSWORD: ${{ secrets.KEYSTORE_PASSWORD }}
    KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}
  run: |
    # APK 생성을 강제로 확인
    echo "android.package_format = apk" >> buildozer.spec
    buildozer android release

- name: Find APK files
  run: |
    echo "=== APK 파일 검색 ==="
    find . -name "*.apk" -type f | while read file; do
      echo "Found APK: $file"
      ls -la "$file"
    done

- name: Upload APK artifact
  uses: actions/upload-artifact@v4
  with:
    name: sannaeeum-link-apk
    path: |
      **/*.apk
    if-no-files-found: error
